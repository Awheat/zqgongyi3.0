define("my_info",["jquery","jquery.validate","distpicker","utils/utils.form.js"],function(require,exports,module){var $=require("jquery");require("jquery.validate"),require("distpicker");require("utils/utils.form.js");$(function(){var e={isAjax:!1,init:function(){var e=this;e.editfields={name:$("#username"),gender:$(".form-gender"),address:$(".distpicker"),sphere:$(".form-sphere"),skills:$(".list-skills")},e.formBaseInfo=$("#formBaseInfo"),e.btnAddLabel=$(".btn-add-skill"),e.formHiddenGender=$('input[name="gender'),e.formHiddenSphere=$('input[name="sphere'),e.formHiddenSkills=$('input[name="skills'),e.formBaseInfo.validate(this.validatorConfigOne),e.bindEvent(),e.editBaseInfo()},validatorConfigOne:{ignore:"",rules:{username:{required:!0},sphere:{required:!0},county:{required:!0}},messages:{username:{required:"请输入昵称"},sphere:{required:"请选择关注领域"},county:{required:"请选择"}},submitHandler:function(e){i.submit(e)}},bindEvent:function(){var e=this;this.editfields.gender.on("click","span.radio",function(){var t=$(this);t.addClass("cur").siblings("span").removeClass("cur"),e.formHiddenGender.val(t.attr("data-gid"))}),this.editfields.sphere.on("click","i[data-id]",function(){$("#sphere-error").text(""),$(this).toggleClass("chk"),e.reloadSphereValue()}),this.btnAddLabel.on("click",function(){var t=$(this),i=t.prev("input"),r=new Array,a=e.formHiddenSkills.val();if(""!=i.val()){var n=i.val().split(/[,\n\s]/g);r=""!==a?a.split(",").concat(n):n,e.setSkills(r),i.val("")}}),this.editfields.skills.on("click","i",function(){$(this).parent().remove(),e.reloadSkillsValue()}),$(".distpicker > select").on("change",function(){var e=$(this),t=e.attr("data-type");if(3!=t){var i=e.next();i.html('<option value="">--请选择--</option>'),1==t&&i.next().html('<option value="">--请选择--</option>');var r=e.val();if(0!=r){var a=e.parent().attr("data-url");$.getJSON(a,{parent_id:r},function(e){var t=['<option value="">--请选择--</option>'];$.each(e,function(e,i){i.id&&t.push('<option value="'+i.id+'">'+i.class_name+"</option>")}),i.html(t.join(""))})}}})},reloadSphereValue:function(){var e=[];this.editfields.sphere.find("i.chk").each(function(){e.push($(this).text())}),this.formHiddenSphere.val(e)},reloadSkillsValue:function(){var e=[];this.editfields.skills.find("span").each(function(){e.push($(this).text())}),this.formHiddenSkills.val(e)},splitBySpace:function(e){return e.split(/[,\n\s]/g)},setSkills:function(e){var e=e||[],t=this;t.formHiddenSkills.val(e),t.editfields.skills.html("");for(var i=0,r=e.length;i<r;i++)""!==e[i]&&t.editfields.skills.append("<span>"+e[i]+"<i></i></span>")},editBaseInfo:function(){var e=$(".form-gender").attr("data-val");e=1!=e&&2!=e?1:e,this.setGender(e);var t=$(".form-sphere").attr("data-val").split(",");this.setSphere(t);var i=$(".form-skills").attr("data-val").split(",");this.setSkills(i),this.setProvince()},setGender:function(e){var e=e||0,t=this.editfields.gender.find("span.radio");$(t[e-1]).addClass("cur").siblings("span").removeClass("cur"),this.formHiddenGender.val(e)},setSphere:function(e){var t=this,e=e||[];t.formHiddenSphere.val(e);for(var i=0,r=e.length;i<r;i++)this.editfields.sphere.find('i[data-id]:contains("'+e[i]+'")').addClass("chk")},setProvince:function(){var e=$('select[name="province"]'),t=e.attr("data-val");e.val(t);var i=$('select[name="city"]'),t=i.attr("data-val");i.val(t);var r=$('select[name="county"]'),t=r.attr("data-val");r.val(t)}},t={isAjax:!1,init:function(){this.formRealInfo=$("#formRealInfo"),this.realInfo={name:$(".sw_realname").text(),value:$(".sw_cardtype").attr("data-id"),number:$(".sw_cardnum").text()},this.formRealInfo.validate(this.validatorConfigTwo),this.validatorCardNumByType()},validatorConfigTwo:{ignore:":hidden",onkeyup:!1,rules:{realname:{required:!0},cardnumber:{required:!0,isCreditCode:!0,remote:function(){var e=$("#cardnumber").attr("data-url");return e}}},messages:{realname:{required:"请输入真实姓名"},cardnumber:{required:"请输入证件号码",remote:"身份证已经被使用"}},submitHandler:function(e){i.submit(e)}},validatorCardNumByType:function(){var e={trimCenter:function(e){var t=e.replace(/(^\s*)|(\s*$)/g,"");return t.replace(/\s/g,"")},requiredJudge:function(e,t){$(t).attr("aria-required");if("undefined"==typeof Obj&&""==e)return!0}};$.validator.addMethod("isCreditCode",function(i,r){if(e.requiredJudge(i,r))return!0;var a=$("#cardtype").find("option:selected").html();return"身份证"==a?t.creditIdCode(i):"护照"==a?t.passportCode(i):void 0},"请输入有效的证件号");var t={creditIdCode:function(t){var i=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],r=[1,0,10,9,8,7,6,5,4,3,2],a=e.trimCenter(t);if(18!=a.length)return!1;var n=a.split(""),s=0;"x"==n[17].toLowerCase()&&(n[17]=10);for(var d=0;d<17;d++)s+=i[d]*n[d];if(valCodePosition=s%11,n[17]==r[valCodePosition]){var o=a.substring(6,10),l=new Date;return l=l.getFullYear(),!(l-o>=120)}return!1},passportCode:function(t){var i=new RegExp("^[a-zA-Z][0-9.]{7,9}$");return i.test(e.trimCenter(t))}}}},i={btnEdit:$(".btn-edit"),isAjax:!1,init:function(){this.bindEvent()},bindEvent:function(){var i=this;this.btnEdit.on("click",function(){var r=$(this),a=r.attr("data-url"),n=r.attr("data-type"),s=r.attr("data-parent"),d={baseinfo:e,realinfo:t},o=$("."+s);0==n?(i.isAjax&&(i.isAjax=!0),$.post(a,function(e){o.find(".info-show").hide(),o.append(e),r.attr("data-type",1),d[s].init(),i.isAjax=!1})):(o.find(".info-show").show(),o.find(".info-edit").remove(),r.attr("data-type",0))}),$(".ucenter-content").delegate(".cancel-edit","click",function(){var e=$(this);e.parents("div.block").find("i.btn-edit").click()})},submit:function(e){var t=$(e),i=t.serialize(),r=t.attr("data-url");$.ajax({url:r,data:i,dataType:"json",type:"post",success:function(e){var t=e.errcode;if(t>=0){var i=e.type,r=$(0==i?".baseinfo":".realinfo"),a=e.content;r.find(".info-show").remove(),r.find(".info-edit").remove(),r.append(a),r.find(".btn-edit").attr("data-type","0")}else alert(e.errmsg)}})}};i.init()})}),define("utils/utils.form",["jquery"],function(require,exports,module){var $=require("jquery"),e={timer:null,toString:Object.prototype.toString,isArray:function(e){return"[object Array]"===this.toString.call(e)},isString:function(e){return"[object String]"===this.toString.call(e)},isObject:function(e){return"[object Object]"===this.toString.call(e)},isRegEx:function(e){return"[object RegExp]"===this.toString.call(e)},regs:{username:/^[_a-zA-Z0-9\u4E00-\u9FA5]{2,10}$/,mobile:/^1\d{10}$/,email:/^[a-zA-Z0-9_\-]{1,}@[a-zA-Z0-9_\-]{1,}\.[a-zA-Z0-9_\-.]{1,}$/},countDown:function(e,t){var i=this;e.hasClass("disable")||(e.addClass("disable").attr("disabled","disabled"),this.timer=setInterval(function(){e.text(t+" 秒"),t==-1&&(e.text("获取短信验证码").removeClass("disable").attr("disabled",!1),clearInterval(i.timer)),t--},1e3))},addValidatorRules:function(e,t,i){var r=this,a=!0;$.validator.addMethod(e,function(e,i){if(r.isArray(t)){for(var n=0;n<t.length&&!(a=t[n].test(e));n++);return a}return this.optional(i)||t.test(e)},i)}};module.exports=e});