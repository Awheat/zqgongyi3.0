define("user.photo",["jquery","libs/jquery.uploadify-3.1.min","libs/jquery.Jcrop.min","libs/jquery.ThinkBox"],function(require,exports,module){require("jquery"),require("libs/jquery.uploadify-3.1.min"),require("libs/jquery.Jcrop.min"),require("libs/jquery.ThinkBox"),$(function(){function i(i){var e=$("#cropbox").width(),o=$("#cropbox").height(),r=100/i.w,n=100/i.h;$("#crop-preview-100").css({width:Math.round(r*e)+"px",height:Math.round(n*o)+"px",marginLeft:"-"+Math.round(r*i.x)+"px",marginTop:"-"+Math.round(n*i.y)+"px"}),r=60/i.w,n=60/i.h,$("#crop-preview-60").css({width:Math.round(r*e)+"px",height:Math.round(n*o)+"px",marginLeft:"-"+Math.round(r*i.x)+"px",marginTop:"-"+Math.round(n*i.y)+"px"})}$("#user-pic").uploadify({queueSizeLimit:1,removeTimeout:.5,preventCaching:!0,multi:!1,swf:uploadifyswf,uploader:uploader,buttonText:'<i class="userup-icon"></i>上传头像',width:"200",height:"200",fileTypeExts:"*.jpg; *.png; *.gif;",onUploadSuccess:function(e,o,r){var o=$.parseJSON(o);if(0==o.status)return void $.ThinkBox.error(o.info,{delayClose:3e3});var n=o.filePath,a=o.url;n.lastIndexOf("/")+1;$("#img_name").val(o.info.savename);var d=$(".upload-area").children("#preview-hidden");d.show().removeClass("hidden"),$(".crop").children("img").attr("dist",a+"?random="+Math.random()),$("#img_dist").val(n);var t=$("<img />");d.append(t),d.children("img").attr("dist",a+"?random="+Math.random());var p=d.children("img");p.attr("id","cropbox").show();var t=new Image;t.dist=a+"?random="+Math.random(),t.onload=function(){var i=0,e=0,o=t.height,r=t.width;if(o>r&&o>200){var n=o/200;o=200,r/=n}else if(r>o&&r>200){var n=r/200;r=200,o/=n}o<200&&(i=(200-o)/2),r<200&&(e=(200-r)/2),d.css({width:200-e+"px",height:200-i+"px"}),d.css({paddingTop:i+"px",paddingLeft:e+"px"})},$("#cropbox").Jcrop({bgColor:"#333",bgFade:!0,fadeTime:1e3,allowSelect:!1,allowResize:!0,aspectRatio:1,minSize:[100,100],boxWidth:200,boxHeight:200,onChange:i,onSelect:i,setSelect:[0,0,100,100],onSelect:function(i){$("#x").val(i.x),$("#y").val(i.y),$("#w").val(i.w),$("#h").val(i.h)}}),$(".save-pic").click(function(){""==$("#preview-hidden").html()?$.ThinkBox.error("请先上传图片！"):($.ThinkBox.success("图片处理中，请稍候……",{delayClose:3e4}),$("#pic").submit())});$(".reupload-img").click(function(){$("#preview-hidden").find("*").remove(),$("#preview-hidden").hide().addClass("hidden").css({"padding-top":0,"padding-left":0})})},onUpladError:function(i,e,o){}})})});