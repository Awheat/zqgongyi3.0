define("org.sett",["jquery","jquery.validate","utils/utils.form.js"],function(require,exports,module){var $=require("jquery");require("jquery.validate");var utilsForm=require("utils/utils.form.js");$(function(){var editBaseInfo={isAjax:!1,init:function(){var e=this;e.editfields={sphere:$(".form-sphere")},e.formBaseInfo=$(".form"),e.formHiddenSphere=$("#category"),e.formBaseInfo.validate(this.validatorConfigOne);var t=/^(https?|ftp):\/\/[^\s]+$/i;utilsForm.addValidatorRules("isWebSite",t,"请输入合法网址"),utilsForm.addValidatorRules("ckLength",/^[_a-zA-Z0-9\u4E00-\u9FA5]{0,500}$/,"请输1-500字符的内容"),e.bindEvent(),e.editBaseInfo()},validatorConfigOne:{ignore:"",onkeyup:!1,submitHandler:function(e){myInfo.submit(e)},success:function(e){},rules:{countyid:{required:!0},category:{required:!0},web_url:{isWebSite:!0},summary:{ckLength:!0}},messages:{countyid:{required:"请选择常住地址"},category:{required:"请选择关注领域"}}},bindEvent:function(){var self=this;this.editfields.sphere.on("click","i[data-id]",function(){$("#sphere-error").text(""),$(this).toggleClass("chk"),self.reloadSphereValue()}),window.AjaxUpload&&(window.upload=function(){var loadBtn=["logo"];$.each(loadBtn,function(index,ele){var button=$("#btn-upload_"+ele),interval,url=button.attr("data-url");new AjaxUpload(button,{name:"img_file_"+ele,action:url,onSubmit:function(e,t){return t&&/^(jpg|JPG|png|PNG|jpeg|JPEG)$/.test(t)?void $("#image-preview_"+ele).attr("dist",load).show():(alert("您上传的图片格式不对，请重新选择！"),!1)},onComplete:function(file,response){var obj=eval("("+response+")");0===obj.status&&alert(obj.info),$("#image-preview_"+ele).attr("dist",obj.url),$("input[name='"+ele+"']").val(obj.imgName),window.upload()}})})},window.upload())},reloadSphereValue:function(){var e=[];this.editfields.sphere.find("i.chk").each(function(){e.push($(this).text())}),this.formHiddenSphere.val(e)},splitBySpace:function(e){return e.split(/[,\n\s]/g)},editBaseInfo:function(){var e=$("#category").val().split(",");this.setSphere(e)},setSphere:function(e){var t=this,e=e||[];t.formHiddenSphere.val(e);for(var i=0,r=e.length;i<r;i++)this.editfields.sphere.find('i[data-id]:contains("'+e[i]+'")').addClass("chk")}},editRealInfo={isAjax:!1,init:function(){this.formRealInfo=$("form"),this.realInfo={name:$(".sw_realname").text(),value:$(".sw_cardtype").attr("data-id"),number:$(".sw_cardnum").text()},this.formRealInfo.validate(this.validatorConfigTwo),this.validatorCardNumByType()},validatorConfigTwo:{ignore:":hidden",onkeyup:!1,rules:{contact:{required:!0},idcard:{required:!0,isCreditCode:!0},mail:{email:!0}},messages:{contact:{required:"请输入真实姓名"},idcard:{required:"请输入证件号码",isCreditCode:"身份证错误"},mail:{email:"请输入合法的邮箱"}},submitHandler:function(e){myInfo.submit(e)}},validatorCardNumByType:function(){var e={trimCenter:function(e){var t=e.replace(/(^\s*)|(\s*$)/g,"");return t.replace(/\s/g,"")},requiredJudge:function(e,t){$(t).attr("aria-required");if("undefined"==typeof Obj&&""==e)return!0}};$.validator.addMethod("isCreditCode",function(i,r){if(e.requiredJudge(i,r))return!0;var n=$("#cardtype").find("option:selected").html();return"身份证"==n?t.creditIdCode(i):"护照"==n?t.passportCode(i):void 0},"请输入有效的证件号");var t={creditIdCode:function(t){var i=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],r=[1,0,10,9,8,7,6,5,4,3,2],n=e.trimCenter(t);if(18!=n.length)return!1;var a=n.split(""),o=0;"x"==a[17].toLowerCase()&&(a[17]=10);for(var d=0;d<17;d++)o+=i[d]*a[d];if(valCodePosition=o%11,a[17]==r[valCodePosition]){var s=n.substring(6,10),l=new Date;return l=l.getFullYear(),!(l-s>=120)}return!1},passportCode:function(t){var i=new RegExp("^[a-zA-Z][0-9.]{7,9}$");return i.test(e.trimCenter(t))}}}},myInfo={btnEdit:$(".btn-edit"),isAjax:!1,init:function(){this.bindEvent()},bindEvent:function(){var e=this;this.btnEdit.on("click",function(){var t=$(this),i=t.attr("data-url"),r=t.attr("data-type"),n=t.attr("data-parent"),a={baseinfo:editBaseInfo,realinfo:editRealInfo},o=$("."+n);if(0==r){if($(".info-edit").length>0)return;if(e.isAjax)return;e.isAjax=!0,$.post(i,function(i){o.find(".info-show").hide(),o.append(i),t.attr("data-type",1),a[n].init(),e.isAjax=!1})}else o.find(".info-show").show(),o.find(".info-edit").remove(),t.attr("data-type",0)}),$(".ucenter-content").delegate(".cancel-edit","click",function(){var e=$(this);e.parents("div.block").find("i.btn-edit").click()})},submit:function(e){var t=$(e),i=t.serialize(),r=t.attr("data-url");$.ajax({url:r,data:i,dataType:"json",type:"post",success:function(e){var t=e.errcode;if(t>=0){var i=e.type,r=$(0==i?".baseinfo":".realinfo"),n=e.content;r.find(".info-show").remove(),r.find(".info-edit").remove(),r.append(n),r.find(".btn-edit").attr("data-type","0")}else alert(e.errmsg)}})}};myInfo.init()})}),define("utils/utils.form",["jquery"],function(require,exports,module){var $=require("jquery"),e={timer:null,toString:Object.prototype.toString,isArray:function(e){return"[object Array]"===this.toString.call(e)},isString:function(e){return"[object String]"===this.toString.call(e)},isObject:function(e){return"[object Object]"===this.toString.call(e)},isRegEx:function(e){return"[object RegExp]"===this.toString.call(e)},regs:{username:/^[_a-zA-Z0-9\u4E00-\u9FA5]{2,10}$/,mobile:/^1\d{10}$/,email:/^[a-zA-Z0-9_\-]{1,}@[a-zA-Z0-9_\-]{1,}\.[a-zA-Z0-9_\-.]{1,}$/},countDown:function(e,t){var i=this;e.hasClass("disable")||(e.addClass("disable").attr("disabled","disabled"),this.timer=setInterval(function(){e.text(t+" 秒"),t==-1&&(e.text("获取短信验证码").removeClass("disable").attr("disabled",!1),clearInterval(i.timer)),t--},1e3))},addValidatorRules:function(e,t,i){var r=this,n=!0;$.validator.addMethod(e,function(e,i){if(r.isArray(t)){for(var a=0;a<t.length&&!(n=t[a].test(e));a++);return n}return this.optional(i)||t.test(e)},i)}};module.exports=e});