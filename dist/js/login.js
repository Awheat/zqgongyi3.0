define("login",["jquery","jquery.validate","utils/utils.form.js"],function(require,exports,module){var $=require("jquery");require("jquery.validate");var e=require("utils/utils.form.js");$(function(){var t={dom:{loginMain:$(".login-main"),formLogin:$("#formLogin"),btnComLogin:$(".btn-com-login"),btnGetMsgCode:$(".btn-msg"),btnRemenber:$("#remember")},init:function(){this.dom.formLogin.validate(this.validatorConfig),e.addValidatorRules("isUsernameOrPhone",[e.regs.mobile,e.regs.username],"请输入合法的用户名或手机号"),e.addValidatorRules("isPhone",e.regs.mobile,"请输入合法的手机号"),this.bindEvent()},bindEvent:function(){var t=this;this.dom.btnComLogin.on("click",function(){var e=$(this),r=e.attr("data-id"),i=t.dom.loginMain.find(".form-title"),o=e.next('input[type="hidden"]'),n={text0:"普通登录",text1:"手机登录"};0==r?(i.text(n.text0),e.text(n.text1).attr("data-id","1"),o.val(0)):(i.text(n.text1),e.text(n.text0).attr("data-id","0"),o.val(1)),$(".common-login,.message-login").toggleClass("hidden")}),this.dom.btnGetMsgCode.on("click",function(){var t=$(this);$.ajax({url:t.attr("data-url"),type:"post",dataType:"json",data:{telephone:$("#telephone").val()},success:function(r){1==r.status?e.countDown(t,60):($("#msgcode-error").remove(),t.parent("p.form-item").append('<label id="msgcode-error" class="error" for="msgcode">'+r.errmsg+"</label>"))}})})},validatorConfig:{ignore:":hidden",submitHandler:function(e){var t=$(e).serialize();$.ajax({url:$(e).attr("data-url"),type:"post",dataType:"json",data:t,success:function(t){var r=$("#logintype").val();if(0===t.errcode){var i=$(e).attr("data-returnurl");location.href=i}else if(t.errcode<0){var o=t.errmsg,n="";1==r?n=t.errcode==-1?"telephone":"msgcode":0==r&&(n=t.errcode==-1?"usernameortel":"password"),$("#"+n+"-error").text(o).show()}}})},errorPlacement:function(e,t){e.appendTo(t.parent())},success:function(e){"telephone"===e[0].getAttribute("for")&&$("button.disable").removeClass("disable")},rules:{usernameortel:{required:!0,isUsernameOrPhone:!0},password:{required:!0},telephone:{required:!0,isPhone:!0},msgcode:{required:!0,remote:{url:$("#msgcode").attr("data-url"),type:"post",data:{msgcode:function(){return $("#msgcode").val()}}}}},messages:{usernameortel:{required:"请输入用户名/手机号"},password:{required:"请输入密码"},telephone:{required:"请输入手机号"},msgcode:{required:"请输入短信验证码",remote:"短信验证码错误"}}}};t.init()})}),define("utils/utils.form",["jquery"],function(require,exports,module){var $=require("jquery"),e={timer:null,toString:Object.prototype.toString,isArray:function(e){return"[object Array]"===this.toString.call(e)},isString:function(e){return"[object String]"===this.toString.call(e)},isObject:function(e){return"[object Object]"===this.toString.call(e)},isRegEx:function(e){return"[object RegExp]"===this.toString.call(e)},regs:{username:/^[_a-zA-Z0-9\u4E00-\u9FA5]{2,10}$/,mobile:/^1\d{10}$/,email:/^[a-zA-Z0-9_\-]{1,}@[a-zA-Z0-9_\-]{1,}\.[a-zA-Z0-9_\-.]{1,}$/},countDown:function(e,t){var r=this;e.hasClass("disable")||(e.addClass("disable").attr("disabled","disabled"),this.timer=setInterval(function(){e.text(t+" 秒"),t==-1&&(e.text("获取短信验证码").removeClass("disable").attr("disabled",!1),clearInterval(r.timer)),t--},1e3))},addValidatorRules:function(e,t,r){var i=this,o=!0;$.validator.addMethod(e,function(e,r){if(i.isArray(t)){for(var n=0;n<t.length&&!(o=t[n].test(e));n++);return o}return this.optional(r)||t.test(e)},r)}};module.exports=e});